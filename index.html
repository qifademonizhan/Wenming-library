<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ë¬¸ëª…ê³  ë„ì„œê´€ ë„ì„œì‹ ì²­ í˜ì´ì§€</title>
  <style>
    body {
      font-family: "Noto Sans KR", sans-serif;
      background-color: #f8f9fa;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #003366;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.5em;
    }

    .name-section {
      background-color: #ffffff;
      padding: 20px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }

    .name-section input {
      width: 200px;
      padding: 8px;
      font-size: 1em;
    }

    .toolbar {
      background-color: #e9ecef;
      padding: 10px;
      text-align: right;
      border-bottom: 1px solid #ccc;
    }

    .toolbar button {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.9em;
    }

    .toolbar button:hover {
      background-color: #0056b3;
    }

    .book-list {
      padding: 20px;
    }

    .book-item {
      background-color: #ffffff;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .book-info {
      flex: 1;
    }

    .book-info strong {
      display: block;
      font-size: 1.1em;
    }

    .book-buttons button {
      margin-left: 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9em;
    }

    .approve {
      background-color: #28a745;
      color: white;
    }

    .reject {
      background-color: #dc3545;
      color: white;
    }

    .approve:hover {
      background-color: #218838;
    }

    .reject:hover {
      background-color: #c82333;
    }
  </style>
</head>
<body>
  <header>
    ğŸ“š í•™êµ ë„ì„œê´€ ë„ì„œì‹ ì²­ í˜ì´ì§€
  </header>

  <div class="name-section">
    <label for="username">ì´ë¦„: </label>
    <input type="text" id="username" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”" />
  </div>

  <div class="toolbar">
    <button id="onBoard">+ ë„ì„œ ì‹ ì²­</button>
  </div>

  <div class="book-list"></div>

  <!-- Firebase ë¡œì§ -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      getDoc,
      deleteDoc,
      doc,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // Firebase ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyCh0YBjDl_KEpn8iRaeAiCo7qD5roORJ_Q",
      authDomain: "wenminggaozhongtushuguan.firebaseapp.com",
      projectId: "wenminggaozhongtushuguan",
      storageBucket: "wenminggaozhongtushuguan.firebasestorage.app",
      messagingSenderId: "308606298489",
      appId: "1:308606298489:web:29e32e866808a55ae267a8"
    };

    // Firebase ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const bookList = document.querySelector(".book-list");
    const addBookButton = document.getElementById("onBoard");

    // ğŸ“– ë„ì„œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadBooks() {
      bookList.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "books"));
      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const div = document.createElement("div");
        div.classList.add("book-item");
        div.dataset.id = docSnap.id;
        div.innerHTML = `
          <div class="book-info">
            <strong>ë„ì„œëª…: ${data.bookName}</strong>
            <span>ì‹ ì²­ì¸: ${data.requester}</span>
            ${data.status === "approved" ? '<span style="color:green;font-weight:bold;">ìŠ¹ì¸ë¨ âœ…</span>' : ""}
          </div>
          <div class="book-buttons">
            ${
              data.status === "approved"
                ? ""
                : `<button class="approve">ìŠ¹ì¸</button>
                   <button class="reject">ê±°ë¶€</button>`
            }
          </div>`;
        bookList.appendChild(div);
      });
    }

    // â• ë„ì„œ ì¶”ê°€
    addBookButton.addEventListener("click", async () => {
      const bookName = prompt("ë„ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš”:");
      const requesterInput = document.getElementById("username");
      const requester =
        requesterInput.value.trim() || prompt("ì‹ ì²­ì¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:");

      if (!bookName || !requester) {
        alert("ë„ì„œëª…ê³¼ ì‹ ì²­ì¸ì„ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”.");
        return;
      }

      await addDoc(collection(db, "books"), {
        bookName,
        requester,
        status: "pending"
      });
      await loadBooks();
    });

    // âœ… ìŠ¹ì¸ / âŒ ê±°ë¶€ ê¸°ëŠ¥
    document.addEventListener("click", async (e) => {
      if (
        e.target.classList.contains("approve") ||
        e.target.classList.contains("reject")
      ) {
        const bookItem = e.target.closest(".book-item");
        const bookId = bookItem.dataset.id;

        // Firestore ë¹„ë°€ë²ˆí˜¸ í™•ì¸
        const pwDoc = await getDoc(doc(db, "password", "password"));
        const accessCord = pwDoc.data().accessCord;

        const inputPw = prompt("ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:");
        if (inputPw !== accessCord) {
          alert("ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤ âŒ");
          return;
        }

        if (e.target.classList.contains("approve")) {
          await updateDoc(doc(db, "books", bookId), { status: "approved" });
          alert("ë„ì„œê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤ âœ…");
        } else {
          await deleteDoc(doc(db, "books", bookId));
          alert("ë„ì„œê°€ ê±°ë¶€ë˜ì–´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤ âŒ");
        }

        await loadBooks();
      }
    });

    // ì²« ë¡œë“œ ì‹œ ë„ì„œ ëª©ë¡ í‘œì‹œ
    loadBooks();
  </script>
</body>
</html>
